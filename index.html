<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enigma I - Historical Implementation</title>

<style>
:root{
    --bg1:#020617;
    --bg2:#0f172a;
    --text:#e5e7eb;
    --border:#334155;
    --accent:#6366f1;
    --error:#f87171;
}

*{box-sizing:border-box}

body{
    margin:0;
    min-height:100vh;
    background:
        radial-gradient(circle at top,#1e293b,transparent 40%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
    font-family:system-ui,Segoe UI,sans-serif;
    color:var(--text);
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px;
}

.enigma{
    width:720px;
    max-width:95%;
    background:rgba(2,6,23,.95);
    border-radius:20px;
    padding:28px;
    box-shadow:0 30px 70px rgba(0,0,0,.65);
}

h1{text-align:center;margin-bottom:22px}

.card{
    background:linear-gradient(180deg,#0b1224,#020617);
    border-radius:16px;
    padding:16px;
    margin-bottom:18px;
    border:1px solid var(--border);
}

label{font-size:13px;opacity:.85;margin-bottom:6px;display:block}

textarea,input,select{
    width:100%;
    border-radius:10px;
    border:1px solid var(--border);
    padding:10px;
    background:#020617;
    color:var(--text);
}

textarea{height:90px;resize:none}

.rotor-grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:18px;
    text-align:center;
}

.rotor-col{
    display:flex;
    flex-direction:column;
    gap:12px;
}

.input-group{
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.input-group label{
    font-size: 11px;
    margin-bottom: 2px;
    color: #94a3b8;
}

.section-title{
    text-align:center;
    font-size:13px;
    opacity:.7;
    margin:12px 0 6px;
}

.rotor-display{
    display:flex;
    justify-content:center;
    gap:24px;
    margin-top:18px;
}

.rotor{
    width:56px;
    height:56px;
    border-radius:50%;
    background:radial-gradient(circle at top,#334155,#020617);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:22px;
    font-weight:700;
    transition:transform .4s ease;
}

.rotor.spin{transform:rotate(360deg)}

.warning{
    color:var(--error);
    text-align:center;
    font-size:13px;
    font-weight:700;
    display:none;
    margin-bottom:14px;
}

.button-group{
    display:flex;
    gap:14px;
    margin:26px 0;
}

button{
    flex:1;
    padding:14px;
    border:none;
    border-radius:14px;
    font-size:15px;
    cursor:pointer;
    color: white;
}

.primary{background:linear-gradient(180deg,#818cf8,#4f46e5)}
.secondary{background:#1e293b;color:#94a3b8}
</style>
</head>

<body>

<div class="enigma">
<h1>Enigma I</h1>

<div class="card">
<label>Input</label>
<textarea id="userInput"></textarea>
</div>

<div class="card">
<label>Plugboard (AB CD EF)</label>
<input id="pbSettings">
</div>

<div id="rotorWarning" class="warning">
ROTOR ERROR: CHOOSE THREE DIFFERENT TYPES
</div>

<div class="card">
<div class="rotor-grid">
<div class="rotor-col">
<label>Left Rotor</label>
<select id="selL" onchange="validateRotors()"><option>I</option><option>II</option><option>III</option></select>
<div class="input-group">
    <label>Position</label>
    <input id="posL" value="A" maxlength="1">
</div>
<div class="input-group">
    <label>Ring</label>
    <input id="rngL" value="A" maxlength="1">
</div>
</div>

<div class="rotor-col">
<label>Middle Rotor</label>
<select id="selM" onchange="validateRotors()"><option value="II" selected>II</option><option value="I">I</option><option value="III">III</option></select>
<div class="input-group">
    <label>Position</label>
    <input id="posM" value="A" maxlength="1">
</div>
<div class="input-group">
    <label>Ring</label>
    <input id="rngM" value="A" maxlength="1">
</div>
</div>

<div class="rotor-col">
<label>Right Rotor</label>
<select id="selR" onchange="validateRotors()"><option value="III" selected>III</option><option value="I">I</option><option value="II">II</option></select>
<div class="input-group">
    <label>Position</label>
    <input id="posR" value="A" maxlength="1">
</div>
<div class="input-group">
    <label>Ring</label>
    <input id="rngR" value="A" maxlength="1">
</div>
</div>
</div>

<div class="section-title">Rotor Windows</div>

<div class="rotor-display">
<div class="rotor" id="viewL">A</div>
<div class="rotor" id="viewM">A</div>
<div class="rotor" id="viewR">A</div>
</div>
</div>

<div class="card">
<label>Reflector (UKW)</label>
<select id="selRef">
<option value="B">UKW-B</option>
<option value="A">UKW-A</option>
<option value="C">UKW-C</option>
</select>
</div>

<div class="button-group">
<button class="primary" onclick="startCipher()">Encrypt / Decrypt</button>
<button class="secondary" onclick="killAndReset()">Reset</button>
</div>

<div class="card">
<label>Output</label>
<textarea id="resultOutput" readonly></textarea>
</div>
</div>

<script>
const A = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
const W = {
    I: { w: "EKMFLGDQVZNTOWYHXUSPAIBRCJ", n: "Q" },
    II: { w: "AJDKSIRUXBLHWTMCQGZNPYFVOE", n: "E" },
    III: { w: "BDFHJLCPRTXVZNYEIWGAKMUSQO", n: "V" }
};
const R = {
    A: "EJMZALYXVBWFCRQUONTSPIKHGD",
    B: "YRUHQSLDPXNGOKMIEBFZCWVJAT",
    C: "FVPJIAOYEDRZXWGCTKUQSBNMHL"
};

let runId = 0, running = false;

function validateRotors() {
    let ok = selL.value !== selM.value && selL.value !== selR.value && selM.value !== selR.value;
    rotorWarning.style.display = ok ? "none" : "block";
    return ok;
}

function plugs() {
    let m = {}, t = pbSettings.value.toUpperCase().replace(/[^A-Z]/g, "");
    if (!t) return {};
    if (t.length % 2 !== 0) return null;
    for (let i = 0; i < t.length; i += 2) {
        let a = t[i], b = t[i + 1];
        if (a === b || m[a] || m[b]) return null;
        m[a] = b; m[b] = a;
    }
    return m;
}

function step(p, r) {
    let mStep = A[p[1]] === r[1].n;
    let rStep = A[p[2]] === r[2].n;

    if (mStep) {
        p[0] = (p[0] + 1) % 26;
        p[1] = (p[1] + 1) % 26;
    } else if (rStep) {
        p[1] = (p[1] + 1) % 26;
    }
    p[2] = (p[2] + 1) % 26;
}

function enc(c, p, rs, r, ref) {
    let i = A.indexOf(c);
    for (let j = 2; j >= 0; j--) {
        let shift = (p[j] - rs[j] + 26) % 26;
        i = (i + shift) % 26;
        i = A.indexOf(r[j].w[i]);
        i = (i - shift + 26) % 26;
    }
    i = A.indexOf(ref[i]);
    for (let j = 0; j < 3; j++) {
        let shift = (p[j] - rs[j] + 26) % 26;
        i = (i + shift) % 26;
        i = r[j].w.indexOf(A[i]);
        i = (i - shift + 26) % 26;
    }
    return A[i];
}

async function startCipher() {
    if (running || !validateRotors()) return;
    let pMap = plugs(); 
    if (pMap === null && pbSettings.value.trim() !== "") return;

    running = true;
    let id = ++runId;
    let t = userInput.value.toUpperCase().replace(/[^A-Z]/g, "");
    resultOutput.value = "";
    
    let rot = [W[selL.value], W[selM.value], W[selR.value]];
    let pos = [A.indexOf(posL.value.toUpperCase()||'A'), A.indexOf(posM.value.toUpperCase()||'A'), A.indexOf(posR.value.toUpperCase()||'A')];
    let ring = [A.indexOf(rngL.value.toUpperCase()||'A'), A.indexOf(rngM.value.toUpperCase()||'A'), A.indexOf(rngR.value.toUpperCase()||'A')];
    let ref = R[selRef.value];

    for (let c of t) {
        if (id !== runId) break;
        step(pos, rot);
        viewL.textContent = A[pos[0]];
        viewM.textContent = A[pos[1]];
        viewR.textContent = A[pos[2]];
        
        viewR.classList.add("spin");
        setTimeout(() => viewR.classList.remove("spin"), 300);

        let s = pMap[c] || c;
        s = enc(s, pos, ring, rot, ref);
        s = pMap[s] || s;
        
        resultOutput.value += s;
        await new Promise(r => setTimeout(r, 400));
    }
    running = false;
}

function killAndReset() {
    runId++;
    running = false;
    userInput.value = resultOutput.value = pbSettings.value = "";
    selL.value = "I"; selM.value = "II"; selR.value = "III";
    posL.value = posM.value = posR.value = "A";
    rngL.value = rngM.value = rngR.value = "A";
    selRef.value = "B";
    viewL.textContent = viewM.textContent = viewR.textContent = "A";
    rotorWarning.style.display = "none";
}
</script>
</body>
</html>
